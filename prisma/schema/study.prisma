// Study domain models - Enhanced for Timer Management

model StudySession {
  id              String        @id @default(uuid())
  userId          Int
  
  // Session Configuration
  subject         String
  topic           String?
  sessionType     SessionType   @default(CUSTOM)
  plannedDuration Int           // Planned duration in minutes
  notes           String?
  deviceId        String?
  
  // Time Tracking (All times in UTC)
  startTime       DateTime
  endTime         DateTime?
  
  // Pause/Resume Tracking
  pausedAt        DateTime?
  totalPausedTime Int           @default(0) // Total paused time in seconds
  pauseCount      Int           @default(0) // Number of times paused
  
  // Session State
  status          SessionStatus @default(ACTIVE)
  
  // Analytics & Performance
  actualStudyTime Int?          // Actual focus time in minutes (excluding pauses)
  productivityScore Float?      // Calculated score (actual vs planned)
  
  // Metadata
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  pauseEvents     PauseEvent[]
  
  // Indexes for performance
  @@index([userId, status])
  @@index([userId, startTime])
  @@index([startTime])
  @@map("study_sessions")
}

model PauseEvent {
  id              String       @id @default(uuid())
  sessionId       String
  pausedAt        DateTime
  resumedAt       DateTime?
  pauseDuration   Int?         // Duration in seconds
  createdAt       DateTime     @default(now())
  
  session         StudySession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  @@index([sessionId])
  @@map("pause_events")
}

model Subject {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  color       String?  // Hex color for UI
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("subjects")
}

model StudyGoal {
  id              Int        @id @default(autoincrement())
  userId          Int
  title           String
  description     String?
  targetHours     Int        // Target hours per period
  targetPeriod    GoalPeriod @default(WEEKLY)
  isActive        Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("study_goals")
}

// Enhanced Enums
enum SessionType {
  POMODORO_25    // 25 minute Pomodoro
  POMODORO_50    // 50 minute Pomodoro
  CUSTOM         // Custom duration
  DEEP_WORK      // Deep work session (90+ minutes)
  REVIEW         // Review session
}

enum SessionStatus {
  ACTIVE         // Currently running
  PAUSED         // Temporarily paused
  COMPLETED      // Successfully completed
  ABANDONED      // Ended before completion
  EXPIRED        // Auto-expired due to timeout
}

enum GoalPeriod {
  DAILY
  WEEKLY
  MONTHLY
}